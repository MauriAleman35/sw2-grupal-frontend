<!-- section-form.component.html -->
<div class="container mx-auto p-4">
  <div class="flex items-center mb-6">
    <button mat-icon-button color="primary" (click)="cancel()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="text-2xl font-bold text-gray-800 ml-2">
      {{ isEditMode ? 'Editar' : 'Crear' }} Sección
    </h1>
  </div>
  
  <div *ngIf="isLoading" class="flex justify-center my-8">
    <mat-spinner diameter="40"></mat-spinner>
    <span class="ml-3 text-gray-600">Cargando...</span>
  </div>
  
  <div *ngIf="!isLoading" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Formulario -->
    <div class="lg:col-span-2">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Información de la Sección</mat-card-title>
          <mat-card-subtitle *ngIf="event">
            Evento: {{ event.title }}
          </mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <form [formGroup]="sectionForm" (ngSubmit)="onSubmit()" class="section-form">
            <!-- Nombre -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Nombre de la Sección</mat-label>
              <input 
                matInput 
                formControlName="name" 
                placeholder="Ej. VIP, General, Platea"
                required
              >
              <mat-icon matSuffix>label</mat-icon>
              <mat-error *ngIf="nameControl?.hasError('required')">
                El nombre es obligatorio
              </mat-error>
              <mat-error *ngIf="nameControl?.hasError('maxlength')">
                El nombre no puede exceder los 100 caracteres
              </mat-error>
            </mat-form-field>
            
            <!-- Descripción -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Descripción</mat-label>
              <textarea 
                matInput 
                formControlName="description" 
                placeholder="Describe los beneficios o características de esta sección"
                rows="4"
                required
              ></textarea>
              <mat-error *ngIf="descriptionControl?.hasError('required')">
                La descripción es obligatoria
              </mat-error>
              <mat-error *ngIf="descriptionControl?.hasError('maxlength')">
                La descripción no puede exceder los 500 caracteres
              </mat-error>
            </mat-form-field>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Precio -->
              <mat-form-field appearance="outline">
                <mat-label>Precio</mat-label>
                <input 
                  matInput 
                  formControlName="price" 
                  type="number"
                  min="0"
                  step="0.01"
                  required
                >
                <span matPrefix>Bs.&nbsp;</span>
                <mat-icon matSuffix>attach_money</mat-icon>
                <mat-error *ngIf="priceControl?.hasError('required')">
                  El precio es obligatorio
                </mat-error>
                <mat-error *ngIf="priceControl?.hasError('min')">
                  El precio no puede ser negativo
                </mat-error>
              </mat-form-field>
              
              <!-- Capacidad -->
              <mat-form-field appearance="outline">
                <mat-label>Capacidad</mat-label>
                <input 
                  matInput 
                  formControlName="capacity" 
                  type="number"
                  min="1"
                  step="1"
                  required
                >
                <mat-icon matSuffix>people</mat-icon>
                <mat-error *ngIf="capacityControl?.hasError('required')">
                  La capacidad es obligatoria
                </mat-error>
                <mat-error *ngIf="capacityControl?.hasError('min')">
                  La capacidad debe ser al menos 1
                </mat-error>
              </mat-form-field>
            </div>
            
            <!-- Color -->
            <div class="mb-4">
              <label class="text-gray-700 font-medium mb-2 block">Color de la Sección</label>
              <div class="color-selector">
                <div 
                  *ngFor="let color of sectionColors" 
                  class="color-option" 
                  [style.backgroundColor]="color"
                  [class.selected]="colorControl?.value === color"
                  (click)="colorControl?.setValue(color)"
                ></div>
              </div>
            </div>
            
            <!-- Estado -->
            <div class="mb-4">
              <mat-slide-toggle formControlName="is_active" color="primary">
                Sección Activa
              </mat-slide-toggle>
              <p class="text-sm text-gray-500 mt-1">
                Las secciones inactivas no estarán disponibles para la venta
              </p>
            </div>
            
            <!-- Botones -->
            <div class="flex justify-end gap-3 mt-6">
              <button 
                type="button" 
                mat-stroked-button 
                (click)="cancel()"
                [disabled]="isSubmitting"
              >
                Cancelar
              </button>
              
              <button 
                type="submit" 
                mat-raised-button 
                color="primary"
                [disabled]="sectionForm.invalid || isSubmitting"
              >
                <mat-icon>save</mat-icon>
                {{ isEditMode ? 'Actualizar' : 'Crear' }} Sección
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
    
    <!-- Vista previa -->
    <div class="lg:col-span-1">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Vista Previa</mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <div class="preview-card">
            <div class="preview-header" [style.backgroundColor]="colorControl?.value + '20'">
              <div class="preview-color" [style.backgroundColor]="colorControl?.value"></div>
              <div class="preview-status">
                <span 
                  class="status-indicator" 
                  [class.active]="isActiveControl?.value"
                >
                  {{ isActiveControl?.value ? 'Activa' : 'Inactiva' }}
                </span>
              </div>
            </div>
            
            <div class="preview-content">
              <h3 class="preview-name">{{ nameControl?.value || 'Nombre de la Sección' }}</h3>
              <p class="preview-description">{{ descriptionControl?.value || 'Descripción de la sección' }}</p>
              
              <div class="preview-details">
                <div class="preview-detail">
                  <mat-icon>attach_money</mat-icon>
                  <span>Bs. {{ priceControl?.value || 0 }}</span>
                </div>
                
                <div class="preview-detail">
                  <mat-icon>people</mat-icon>
                  <span>{{ capacityControl?.value || 0 }} asientos</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="preview-info mt-6">
            <h4 class="text-lg font-medium mb-2">Información Adicional</h4>
            <p class="text-sm text-gray-600 mb-4">
              Esta vista previa muestra cómo se verá la sección en la lista de secciones.
            </p>
            
            <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
              <h5 class="text-blue-800 font-medium flex items-center">
                <mat-icon class="text-blue-600 mr-1">info</mat-icon>
                Consejos
              </h5>
              <ul class="text-sm text-blue-700 mt-2 list-disc pl-5">
                <li>Usa nombres descriptivos para las secciones</li>
                <li>Incluye detalles sobre los beneficios en la descripción</li>
                <li>Asigna colores distintos para identificar fácilmente las secciones</li>
                <li>Establece precios coherentes entre las diferentes secciones</li>
              </ul>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>